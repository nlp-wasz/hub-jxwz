
## 💬 AI 聊天服务 API 接口文档

该文档描述了基于代理 (Agent) 的 AI 聊天服务相关的 RESTful API 接口，所有接口都通过一个 **FastAPI `APIRouter`** 进行定义，基础路径为 `/v1/chat`。

### 📌 基本响应结构

除流式接口外，所有接口的返回数据都遵循统一的 `BasicResponse` 结构：

| 字段 | 类型 | 描述 |
| :--- | :--- | :--- |
| **`code`** | `int` | 状态码，例如 `200` 表示成功，`500` 表示服务器/异常错误。 |
| **`message`** | `str` | 描述信息。 |
| **`data`** | `list` / `dict` / `None` | 返回的具体数据。 |

---

### 🗨️ 1. 聊天交互（流式响应） (`/`)

| 属性 | 描述 |
| :--- | :--- |
| **方法** | `POST` |
| **路径** | `/v1/chat/` |
| **功能** | 发送聊天消息并以 **Server-Sent Events (SSE)** 流式接收回复。 |

#### 请求体 (`RequestForChat`)

| 字段 | 类型 | 描述 | 示例 |
| :--- | :--- | :--- | :--- |
| **`user_name`** | `str` | 发送消息的用户名。 | `"Alice"` |
| **`task`** | `str` | 任务类型或代理配置（用于 Agent 初始化）。 | `"general_chat"` |
| **`session_id`** | `str` | 当前聊天会话的 ID，用于维持上下文。 | `"abc123xyz"` |
| **`content`** | `str` | 用户发送的消息内容。 | `"你好，介绍一下FastAPI"` |
| **`tools`** | `Union[list, None]` | 供 Agent 使用的工具列表（可选）。 | `["web_search"]` |

#### 响应状态码

| 状态类型 | 媒体类型 | 描述 |
| :--- | :--- | :--- |
| **成功** | `text/event-stream` | **StreamingResponse**，数据块以 SSE 格式实时返回。 |
| **失败** | `application/json` | `BasicResponse(code=500)`，返回 Traceback 信息。 |

---

### 🆕 2. 初始化新会话 (`/init`)

| 属性 | 描述 |
| :--- | :--- |
| **方法** | `POST` |
| **路径** | `/v1/chat/init` |
| **功能** | 生成一个新的、唯一的聊天会话 ID (`session_id`)。 |

#### 请求体

* **无**

#### 响应体

| Code | Message (示例) | Data (示例) | 描述 |
| :--- | :--- | :--- | :--- |
| `200` | `"ok"` | `{"session_id": "new_session_id_456"}` | 返回新生成的会话 ID。 |
| `500` | *Traceback* | `[]` | 异常错误。 |

---

### 🔍 3. 获取聊天会话记录 (`/get`)

| 属性 | 描述 |
| :--- | :--- |
| **方法** | `POST` |
| **路径** | `/v1/chat/get` |
| **功能** | 根据 `session_id` 获取该会话的所有聊天消息记录。 |

#### 请求体

* **参数类型**: **查询参数或请求体字段** (接收 `session_id` 参数)。
* **字段**: **`session_id`** (`str`) - 要查询的会话 ID。

#### 响应体

| Code | Message (示例) | Data (示例) | 描述 |
| :--- | :--- | :--- | :--- |
| `200` | `"ok"` | `[{message_1}, {message_2}, ...]` | 返回会话消息列表。 |
| `500` | *Traceback* | `[]` | 异常错误。 |

---

### 🧹 4. 删除聊天会话 (`/delete`)

| 属性 | 描述 |
| :--- | :--- |
| **方法** | `POST` |
| **路径** | `/v1/chat/delete` |
| **功能** | 根据 `session_id` 删除指定的聊天会话及其所有记录。 |

#### 请求体

* **参数类型**: **查询参数或请求体字段** (接收 `session_id` 参数)。
* **字段**: **`session_id`** (`str`) - 要删除的会话 ID。

#### 响应体

| Code | Message (示例) | Data | 描述 |
| :--- | :--- | :--- | :--- |
| `200` | `"ok"` | `[]` | 删除成功。 |
| `500` | *Traceback* | `[]` | 异常错误。 |

---

### 📚 5. 列出用户所有会话 (`/list`)

| 属性 | 描述 |
| :--- | :--- |
| **方法** | `POST` |
| **路径** | `/v1/chat/list` |
| **功能** | 列出指定用户拥有的所有聊天会话（通常是会话 ID 和标题/摘要）。 |

#### 请求体

* **参数类型**: **查询参数或请求体字段** (接收 `user_name` 参数)。
* **字段**: **`user_name`** (`str`) - 用户名。

#### 响应体

| Code | Message (示例) | Data (示例) | 描述 |
| :--- | :--- | :--- | :--- |
| `200` | `"ok"` | `[{session_meta_1}, {session_meta_2}, ...]` | 返回会话元数据列表。 |
| `500` | *Traceback* | `[]` | 异常错误。 |

---

### 👍 6. 消息反馈 (`/feedback`)

| 属性 | 描述 |
| :--- | :--- |
| **方法** | `POST` |
| **路径** | `/v1/chat/feedback` |
| **功能** | 对指定会话中的特定消息提供反馈（喜欢/不喜欢）。 |

#### 请求体

* **参数类型**: **查询参数或请求体字段** (接收三个参数)。
* **字段**:
    * **`session_id`** (`str`) - 消息所属的会话 ID。
    * **`message_id`** (`int`) - 要反馈的消息在会话中的 ID。
    * **`feedback`** (`bool`) - 反馈值（例如 `True` 表示赞，`False` 表示踩）。

#### 响应体

| Code | Message (示例) | Data | 描述 |
| :--- | :--- | :--- | :--- |
| `200` | `"ok"` | `[]` | 反馈成功记录。 |
| `500` | *Traceback* | `[]` | 异常错误。 |

