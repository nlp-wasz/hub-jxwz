## 文档公式解析与智能问答方案一技术路线
   ### 实施步骤

- 用（mineru、deepseek-ocr、qwen3-vl模型）：将文档中的公式进行结构解析，并生成对应的$\LaTeX$公式，构建知识库。
- 构建RAG流程，根据用户的提问，从知识库中选择topN的公式（可加入rerank）,将用户的提问和候选公式构建成提示词，交给Qwen thinking模型进行回答.
- 优势：语义理解能力强，可进行多步推理；
- 劣势：精度不高，不适合高精度计算；
  
### 方案1具体步骤

- 通过dots.ocr将PDF解析成markdown格式，因为pdf是分页的md，需要对转换后的输出目录进行数据合并；
- 使用Qwen3 Emmbedding模型对公式进行编码和用户的提问做相似度计算，得到top8个公式，将用户的提问和公式构建成prompt送给Qwen3 Thinking模型生成答案；
- 优点： 借助qwen3 thinking 模型进一步选择合适的公式， 因为RAG的检索和排序存在精度误差。
- 缺点： 非常消耗token，没有生成代码，依赖qwen3 thinking 直接生成答案。

### 方案2具体步骤

- 运行read_pdf_or_md.py得到每个pdf文件的文字内容
- 基于文本匹配得到每个问题对应的知识matched.csv，通过本地模型qwen2.5-7b生成答案
- 特点：使用本地模型，回复速度快
- 缺点：小模型推理能力弱，检索仅基于简单的匹配，结果稳定性难保。

### 方案3具体步骤
- 使用 `PyMuPDF` 从所有文档中快速、准确地提取纯文本内容，构建一个包含所有文档信息的知识库。 利用 `sentence-transformers` 库加载一个强大的中文句向量模型 (`shibing624/text2vec-base-chinese`)，对知识库中的所有文档进行向量化，建立语义索引。 对于每一个问题，通过计算向量余弦相似度，检索出与问题语义最相关的 **Top-3** 个候选文档。
- 使用 **Ollama** 在本地部署并运行业界领先的开源模型 **`Qwen3-8B`**。 设计了一个精巧的 **Prompt (提示)**，引导 `Qwen3` 模型对问题和检索到的文档进行深度分析，并输出一个包含其**思考过程、意图判断和多种形式答案**的JSON对象。此过程的详细日志被记录在 `run_log_final.jsonl` 中。
- 优点：使用RAG+本地LLM模型，提高公式的精确检索能力
- 缺点：直接使用PyMuPDF对文本进行解析，导致公式结构化缺失。

