function-assistant/
â”œâ”€â”€ mcp_server_main.py
â”œâ”€â”€ streamlit_demo.py
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md

fastmcp>=0.1.0
streamlit>=1.28.0
openai-agent>=0.1.0
openai>=1.0.0
python-dotenv>=1.0.0
asyncio
typing-extensions

#!/usr/bin/env python3
"""
MCP Server for Function Assistant
ä½¿ç”¨ FastMCP æ¡†æ¶åˆ›å»ºå·¥å…·æœåŠ¡å™¨
"""

import asyncio
import json
from datetime import datetime, timedelta
from typing import Dict, List, Any, Optional
from fastmcp import FastMCP

# åˆ›å»º MCP æœåŠ¡å™¨å®ä¾‹
mcp = FastMCP("Function Assistant")

# æ¨¡æ‹Ÿæ•°æ®åº“å­˜å‚¨
user_tasks = {}
user_calendar = {}

@mcp.tool()
def create_task(task_name: str, description: str, priority: str = "medium", due_date: str = None) -> Dict[str, Any]:
    """åˆ›å»ºæ–°ä»»åŠ¡
    
    Args:
        task_name: ä»»åŠ¡åç§°
        description: ä»»åŠ¡æè¿°
        priority: ä¼˜å…ˆçº§ (low, medium, high)
        due_date: æˆªæ­¢æ—¥æœŸ (YYYY-MM-DDæ ¼å¼)
    
    Returns:
        åˆ›å»ºçš„ä»»åŠ¡ä¿¡æ¯
    """
    task_id = f"task_{len(user_tasks) + 1}"
    task = {
        "id": task_id,
        "name": task_name,
        "description": description,
        "priority": priority,
        "due_date": due_date,
        "status": "pending",
        "created_at": datetime.now().isoformat()
    }
    user_tasks[task_id] = task
    
    return {
        "success": True,
        "message": f"ä»»åŠ¡ '{task_name}' åˆ›å»ºæˆåŠŸ",
        "task": task
    }

@mcp.tool()
def list_tasks(status: str = "all") -> Dict[str, Any]:
    """åˆ—å‡ºæ‰€æœ‰ä»»åŠ¡
    
    Args:
        status: ä»»åŠ¡çŠ¶æ€è¿‡æ»¤ (all, pending, completed)
    
    Returns:
        ä»»åŠ¡åˆ—è¡¨
    """
    if status == "all":
        tasks = list(user_tasks.values())
    else:
        tasks = [task for task in user_tasks.values() if task["status"] == status]
    
    return {
        "count": len(tasks),
        "tasks": sorted(tasks, key=lambda x: x["created_at"], reverse=True)
    }

@mcp.tool()
def complete_task(task_id: str) -> Dict[str, Any]:
    """æ ‡è®°ä»»åŠ¡ä¸ºå®Œæˆ
    
    Args:
        task_id: ä»»åŠ¡ID
    
    Returns:
        æ“ä½œç»“æœ
    """
    if task_id not in user_tasks:
        return {"success": False, "message": f"ä»»åŠ¡ {task_id} ä¸å­˜åœ¨"}
    
    user_tasks[task_id]["status"] = "completed"
    user_tasks[task_id]["completed_at"] = datetime.now().isoformat()
    
    return {
        "success": True,
        "message": f"ä»»åŠ¡ '{user_tasks[task_id]['name']}' å·²å®Œæˆ"
    }

@mcp.tool()
def schedule_meeting(title: str, participants: List[str], duration_minutes: int = 60, 
                    start_time: str = None) -> Dict[str, Any]:
    """å®‰æ’ä¼šè®®
    
    Args:
        title: ä¼šè®®æ ‡é¢˜
        participants: å‚ä¼šäººå‘˜åˆ—è¡¨
        duration_minutes: ä¼šè®®æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
        start_time: å¼€å§‹æ—¶é—´ (YYYY-MM-DD HH:MM æ ¼å¼)ï¼Œé»˜è®¤ä¸º1å°æ—¶å
    
    Returns:
        ä¼šè®®å®‰æ’ä¿¡æ¯
    """
    if start_time:
        start_dt = datetime.strptime(start_time, "%Y-%m-%d %H:%M")
    else:
        start_dt = datetime.now() + timedelta(hours=1)
    
    end_dt = start_dt + timedelta(minutes=duration_minutes)
    meeting_id = f"meeting_{len(user_calendar) + 1}"
    
    meeting = {
        "id": meeting_id,
        "title": title,
        "participants": participants,
        "start_time": start_dt.isoformat(),
        "end_time": end_dt.isoformat(),
        "duration_minutes": duration_minutes,
        "created_at": datetime.now().isoformat()
    }
    
    user_calendar[meeting_id] = meeting
    
    return {
        "success": True,
        "message": f"ä¼šè®® '{title}' å®‰æ’æˆåŠŸ",
        "meeting": meeting
    }

@mcp.tool()
def list_meetings() -> Dict[str, Any]:
    """åˆ—å‡ºæ‰€æœ‰å®‰æ’çš„ä¼šè®®
    
    Returns:
        ä¼šè®®åˆ—è¡¨
    """
    meetings = list(user_calendar.values())
    
    # æŒ‰å¼€å§‹æ—¶é—´æ’åº
    sorted_meetings = sorted(meetings, key=lambda x: x["start_time"])
    
    return {
        "count": len(sorted_meetings),
        "meetings": sorted_meetings
    }

@mcp.tool()
def calculate_working_hours(start_time: str, end_time: str, break_minutes: int = 60) -> Dict[str, Any]:
    """è®¡ç®—å·¥ä½œæ—¶é—´
    
    Args:
        start_time: å¼€å§‹æ—¶é—´ (HH:MM æ ¼å¼)
        end_time: ç»“æŸæ—¶é—´ (HH:MM æ ¼å¼)
        break_minutes: ä¼‘æ¯æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
    
    Returns:
        å·¥ä½œæ—¶é—´è®¡ç®—ç»“æœ
    """
    try:
        start_dt = datetime.strptime(start_time, "%H:%M")
        end_dt = datetime.strptime(end_time, "%H:%M")
        
        if end_dt < start_dt:
            end_dt = end_dt.replace(day=end_dt.day + 1)
        
        total_minutes = (end_dt - start_dt).total_seconds() / 60
        working_minutes = total_minutes - break_minutes
        working_hours = working_minutes / 60
        
        return {
            "success": True,
            "total_minutes": total_minutes,
            "working_minutes": working_minutes,
            "working_hours": round(working_hours, 2),
            "break_minutes": break_minutes
        }
    except Exception as e:
        return {"success": False, "error": str(e)}

@mcp.resource("config://assistant")
def get_assistant_config() -> str:
    """è·å–åŠ©æ‰‹é…ç½®ä¿¡æ¯"""
    config = {
        "name": "Function Assistant",
        "version": "1.0.0",
        "description": "ä¸€ä¸ªå¤šåŠŸèƒ½çš„åŠå…¬åŠ©æ‰‹",
        "available_tools": [
            "create_task", "list_tasks", "complete_task",
            "schedule_meeting", "list_meetings", "calculate_working_hours"
        ]
    }
    return json.dumps(config, ensure_ascii=False, indent=2)

async def main():
    """å¯åŠ¨ MCP æœåŠ¡å™¨"""
    print("ğŸš€ å¯åŠ¨ Function Assistant MCP æœåŠ¡å™¨...")
    print("ğŸ“‹ å¯ç”¨å·¥å…·:")
    print("  â€¢ create_task - åˆ›å»ºæ–°ä»»åŠ¡")
    print("  â€¢ list_tasks - åˆ—å‡ºä»»åŠ¡")
    print("  â€¢ complete_task - å®Œæˆä»»åŠ¡")
    print("  â€¢ schedule_meeting - å®‰æ’ä¼šè®®")
    print("  â€¢ list_meetings - åˆ—å‡ºä¼šè®®")
    print("  â€¢ calculate_working_hours - è®¡ç®—å·¥ä½œæ—¶é—´")
    
    # è¿è¡ŒæœåŠ¡å™¨
    await mcp.run(transport="stdio")

if __name__ == "__main__":
    asyncio.run(main())

#!/usr/bin/env python3
"""
Streamlit æ¼”ç¤ºç•Œé¢ for Function Assistant
ä½¿ç”¨ OpenAI Agent ä¸ MCP æœåŠ¡å™¨äº¤äº’
"""

import streamlit as st
import asyncio
import json
from typing import Dict, Any, List
from openai import OpenAI
from openai_agent import Agent, Msg, Tool
import subprocess
import time
import threading

# é¡µé¢é…ç½®
st.set_page_config(
    page_title="æ™ºèƒ½èŒèƒ½åŠ©æ‰‹",
    page_icon="ğŸ¤–",
    layout="wide",
    initial_sidebar_state="expanded"
)

# è‡ªå®šä¹‰CSSæ ·å¼
st.markdown("""
<style>
    .main-header {
        font-size: 2.5rem;
        color: #1f77b4;
        text-align: center;
        margin-bottom: 2rem;
    }
    .tool-card {
        background-color: #f0f2f6;
        padding: 1rem;
        border-radius: 10px;
        margin: 0.5rem 0;
        border-left: 4px solid #1f77b4;
    }
    .success-message {
        background-color: #d4edda;
        color: #155724;
        padding: 0.75rem;
        border-radius: 5px;
        margin: 0.5rem 0;
    }
    .error-message {
        background-color: #f8d7da;
        color: #721c24;
        padding: 0.75rem;
        border-radius: 5px;
        margin: 0.5rem 0;
    }
</style>
""", unsafe_allow_html=True)

class MCPClient:
    """ç®€åŒ–çš„MCPå®¢æˆ·ç«¯"""
    
    def __init__(self):
        self.process = None
        self.client = None
        self.start_server()
    
    def start_server(self):
        """å¯åŠ¨MCPæœåŠ¡å™¨"""
        try:
            self.
