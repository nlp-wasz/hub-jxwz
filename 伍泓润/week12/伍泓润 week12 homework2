fastmcp>=0.1.0
streamlit>=1.28.0
textblob>=0.17.1

#!/usr/bin/env python3
"""ç²¾ç®€ç‰ˆ MCP æœåŠ¡å™¨"""

import asyncio
from datetime import datetime
from typing import Dict, Any, Annotated
from fastmcp import FastMCP
from textblob import TextBlob

mcp = FastMCP("Function Assistant")

@mcp.tool()
def create_task(task_name: str, description: str) -> Dict[str, Any]:
    """åˆ›å»ºæ–°ä»»åŠ¡"""
    return {
        "success": True,
        "message": f"ä»»åŠ¡ '{task_name}' åˆ›å»ºæˆåŠŸ",
        "task": {
            "name": task_name,
            "description": description,
            "created_at": datetime.now().isoformat()
        }
    }

@mcp.tool()
def list_tasks() -> Dict[str, Any]:
    """åˆ—å‡ºä»»åŠ¡"""
    return {
        "success": True,
        "tasks": [
            {"name": "ç¤ºä¾‹ä»»åŠ¡", "status": "pending"},
            {"name": "å®ŒæˆæŠ¥å‘Š", "status": "completed"}
        ]
    }

@mcp.tool()
def sentiment_classification(text: Annotated[str, "è¦åˆ†æçš„æ–‡æœ¬"]) -> Dict[str, Any]:
    """åˆ†ææ–‡æœ¬æƒ…æ„Ÿ"""
    try:
        blob = TextBlob(text)
        polarity = blob.sentiment.polarity
        
        if polarity > 0.1:
            category, emoji = "positive", "ğŸ˜Š"
        elif polarity < -0.1:
            category, emoji = "negative", "ğŸ˜"
        else:
            category, emoji = "neutral", "ğŸ˜"
        
        return {
            "success": True,
            "text": text,
            "sentiment": {
                "polarity": round(polarity, 3),
                "category": category,
                "emoji": emoji
            }
        }
    except Exception as e:
        return {"success": False, "error": str(e)}

async def main():
    print("ğŸš€ å¯åŠ¨ MCP æœåŠ¡å™¨...")
    await mcp.run(transport="stdio")

if __name__ == "__main__":
    asyncio.run(main())

#!/usr/bin/env python3
"""ç²¾ç®€ç‰ˆ Streamlit ç•Œé¢"""

import streamlit as st
import json
import subprocess
import time

# é¡µé¢é…ç½®
st.set_page_config(page_title="æ™ºèƒ½åŠ©æ‰‹", layout="wide")

st.title("ğŸ¤– æ™ºèƒ½èŒèƒ½åŠ©æ‰‹")

class MCPClient:
    def __init__(self):
        self.process = None
        self.start_server()
    
    def start_server(self):
        try:
            self.process = subprocess.Popen(
                ["python", "mcp_server_main.py"],
                stdin=subprocess.PIPE,
                stdout=subprocess.PIPE,
                stderr=subprocess.PIPE,
                text=True,
                bufsize=1
            )
            time.sleep(1)
        except Exception as e:
            st.error(f"å¯åŠ¨å¤±è´¥: {e}")
    
    def call_tool(self, method: str, params: dict) -> dict:
        try:
            request = {"jsonrpc": "2.0", "id": 1, "method": method, "params": params}
            self.process.stdin.write(json.dumps(request) + "\n")
            self.process.stdin.flush()
            response = self.process.stdout.readline()
            return json.loads(response)
        except:
            return {"error": "é€šä¿¡å¤±è´¥"}

# åˆå§‹åŒ–
if "client" not in st.session_state:
    st.session_state.client = MCPClient()

# ä¾§è¾¹æ 
with st.sidebar:
    st.header("å·¥å…·")
    
    # æƒ…æ„Ÿåˆ†æ
    st.subheader("æƒ…æ„Ÿåˆ†æ")
    text = st.text_input("è¾“å…¥æ–‡æœ¬:")
    if st.button("åˆ†ææƒ…æ„Ÿ"):
        if text:
            result = st.session_state.client.call_tool("sentiment_classification", {"text": text})
            if "result" in result:
                st.session_state.sentiment_result = result["result"]
    
    # ä»»åŠ¡ç®¡ç†
    st.subheader("ä»»åŠ¡ç®¡ç†")
    if st.button("æŸ¥çœ‹ä»»åŠ¡"):
        result = st.session_state.client.call_tool("list_tasks", {})
        if "result" in result:
            st.session_state.tasks = result["result"]["tasks"]

# ä¸»ç•Œé¢
col1, col2 = st.columns(2)

with col1:
    st.header("æƒ…æ„Ÿåˆ†æç»“æœ")
    if "sentiment_result" in st.session_state:
        result = st.session_state.sentiment_result
        if result["success"]:
            sentiment = result["sentiment"]
            st.write(f"æ–‡æœ¬: {result['text']}")
            st.write(f"æƒ…æ„Ÿ: {sentiment['emoji']} {sentiment['category']}")
            st.write(f"ææ€§: {sentiment['polarity']}")
            
            # å¯è§†åŒ–
            progress = (sentiment['polarity'] + 1) / 2
            st.progress(progress, f"æƒ…æ„Ÿææ€§: {sentiment['polarity']:.3f}")

with col2:
    st.header("ä»»åŠ¡åˆ—è¡¨")
    if "tasks" in st.session_state:
        for task in st.session_state.tasks:
            status = "âœ…" if task["status"] == "completed" else "â³"
            st.write(f"{status} {task['name']}")

# å¯¹è¯ç•Œé¢
st.header("å¯¹è¯")
user_input = st.text_input("è¾“å…¥æ¶ˆæ¯:")
if st.button("å‘é€"):
    if user_input:
        # ç®€å•å“åº”é€»è¾‘
        if "æƒ…æ„Ÿ" in user_input or "æƒ…ç»ª" in user_input:
            st.info("æˆ‘å¯ä»¥åˆ†ææ–‡æœ¬æƒ…æ„Ÿï¼Œè¯·åœ¨ä¾§è¾¹æ è¾“å…¥æ–‡æœ¬")
        elif "ä»»åŠ¡" in user_input:
            st.info("æˆ‘å¯ä»¥ç®¡ç†ä»»åŠ¡ï¼Œç‚¹å‡»ä¾§è¾¹æ æŸ¥çœ‹ä»»åŠ¡åˆ—è¡¨")
        else:
            st.info("æˆ‘æ˜¯æ‚¨çš„æ™ºèƒ½åŠ©æ‰‹ï¼Œå¯ä»¥å¸®æ‚¨åˆ†ææƒ…æ„Ÿå’Œç®¡ç†ä»»åŠ¡")

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
python -m textblob.download_corpora

# è¿è¡Œï¼ˆä¸¤ä¸ªç»ˆç«¯ï¼‰
# ç»ˆç«¯1
python mcp_server_main.py

# ç»ˆç«¯2  
streamlit run streamlit_demo.py
