文档 → 公式提取 → 向量库 → 用户提问 → 检索公式 → LLM回答
文档 → 公式解析（结构树） → 增强向量化 → 混合检索 → LLM推理
文档 → 公式图像+LaTeX双模态 → 视觉-文本对齐 → 联合检索 → 代码生成+验证
# 关键技术选择：
# 1. Mathpix/LatexOCR：图像转LaTeX
# 2. PyMuPDF/PDFPlumber：提取文本和公式
# 3. 公式结构解析（可选）：
#    - 使用sympy.parsing.latex解析为语法树
#    - 提取变量、运算符、函数关系
# 检索策略建议：
1. 第一层：向量相似度（公式LaTeX + 上下文文本）
2. 第二层：rerank（考虑：公式类型匹配、变量名匹配、领域相关性）
3. 第三层：公式结构相似度（如解析树编辑距离）

# 为什么top1-8？
# - top1可能不够，公式需要上下文
# - 8个公式可以提供足够的推理材料
# - 平衡召回率和计算成本
用户提问：“求方程x²-5x+6=0的根”

路径A（代码生成）：
输入：提问 + 相关公式LaTeX
→ Qwen思考：识别需求，生成sympy代码
→ 执行：solveset(x**2 - 5*x + 6, x)
→ 验证：检查结果合理性
→ 输出：{2, 3}

路径B（直接推理）：
输入：提问 + 相关公式
→ Qwen思考：逐步推理因式分解
→ 输出：根为2和3

# 融合策略：代码验证优先，推理作为补充/解释
主方案：待选方案2（结构化增强）
备用：待选方案1（快速实现）
复杂场景：待选方案3（多模态）
公式提取层:
  - 工具: LaTeXOCR + PyMuPDF
  - 输出: LaTeX + 位置信息 + 结构树(可选)

检索层:
  - 向量化: text-embedding-3-small
  - 索引: FAISS/Chroma
  - rerank: BGE-reranker

推理层:
  - 主模型: Qwen2.5-72B-Instruct (思考链)
  - 代码执行: sympy + python沙箱
  - 验证: 结果合理性检查
