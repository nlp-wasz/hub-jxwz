## 财报多模态问答项目

### 数据集分析

该数据集是财报类文档，这类文档有着很强的专业性和结构性。比如第一页和第二页一般都有着文档的元信息，都会有文档信息，正文部分会有着大量的表格和图片类信息。同时部分文档是以PPT的形式展示的。有一些图标的无效信息和特定场景下的图片信息需要结合上下文做进一步的理解。

![2025-11-13_09-41.jpg](https://cdn.jsdelivr.net/gh/zilong-ding/note-gen-image-sync@main/6f64c31d-995e-46c2-97fd-6bd05b79a0f5.jpeg)

![2025-11-13_09-41_1.jpg](https://cdn.jsdelivr.net/gh/zilong-ding/note-gen-image-sync@main/549069c3-6efa-410a-bcb0-e4d4ae1ab864.jpeg)

前两页有着专题名称，机构，编辑人等信息。

![2025-11-13_09-42_1.jpg](https://cdn.jsdelivr.net/gh/zilong-ding/note-gen-image-sync@main/3bd90303-2545-4e05-a20e-a6cd163d43ff.jpeg)

![2025-11-13_09-43.jpg](https://cdn.jsdelivr.net/gh/zilong-ding/note-gen-image-sync@main/dc5d45f0-9f5c-4dd1-b44a-26fb9804dd3c.jpeg)

财报第一页都会有一些元信息和重要的概要性信息。

![2025-11-13_09-46_1.jpg](https://cdn.jsdelivr.net/gh/zilong-ding/note-gen-image-sync@main/c6e69414-e22d-48e6-9d21-5baf4e4d1c92.jpeg)

![2025-11-13_09-47.jpg](https://cdn.jsdelivr.net/gh/zilong-ding/note-gen-image-sync@main/f280f3d7-de0c-47d3-8bb8-d33334333ea6.jpeg)

PPT类每页内容比较完整，但是会很“图文并茂“，然后图片解读比较依赖上下文。

![2025-11-13_09-58.jpg](https://cdn.jsdelivr.net/gh/zilong-ding/note-gen-image-sync@main/dce963cc-f900-4f5b-9638-98c5e1c782df.jpeg)

![2025-11-13_09-55.jpg](https://cdn.jsdelivr.net/gh/zilong-ding/note-gen-image-sync@main/d6529581-10c8-47cf-862e-0ec773d21b4b.jpeg)

部分图片embbedding之后其实意义不大，其对应的上一句话或者下一句好可能才是代表含义。

### 实施思路

1. 数据库模型构建（SQL,Miluvs）
2. 文档转换（mineru ）
3. 文档解析（文本、图片embedding+ 图片联系上下文做视觉问答后embedding）
4. 插入数据库sql，milvus
5. 多模态检索（语义相关检索+bm25全文检索+chunk相邻字段返回）
6. 多模态问答

### 数据模型设计

1. 用户查询
   检索与自然语言相匹配的文本或图片
   检索与参考图片相匹配的文本或图片
   根据元信息过滤文档
   获取元信息
2. 搜索方法
   语义搜索
   全文搜索
   元数据过滤
3. 数据模型设计

SQL：用户，知识库，文档

milvus：文档，chunk（文本、图、表）结构基本一致，只是稍微有些区别，图这里会有文件名和文件路径

#### SQL

1. 用户

   用户id ： int

   用户名： str

   密码：hash

   创建时间：str

   可使用的知识库id：list【知识库】
2. 知识库

   知识库id： int

   知识库名称：str

   知识库可被哪些用户使用：list【用户】

   该知识库下的文档：list【文档】

   创建时间：str

   更新记录：json
3. 文档

   文档id：str

   文档名称：str

   文档摘要：str

   文档作者：str

   文档所属机构：str

   文档路径：str

   文档所属知识库：知识库

   创建时间：str

   更新时间：str

   是否导入数据集：bool

#### milvus

1. 文档

   文档id：str

   文档名称：str

   文档摘要：str

   文档作者：str

   文档所属机构：str

   文档路径：str

   文档所属知识库：知识库id

   文档全文：str

   创建时间：str

   更新时间：str

   是否导入数据集：bool
2. chunk

   chunk_id:str
   chunk类型：【文本、图片+上下文、表格+上下文、图片】

   chunk内容：str

   所属文档：文档id

   所属页面：int

   dense_vector：list【float】

   创建时间：str

   更新时间：str

   是否导入数据集：bool

#### fastapi接口模型

##### 增

输入：用户ID，知识库ID，文件

输出：Dict{是否成功：bool，文件id：str，文件元信息：metadata}

##### 删

输入：用户ID,知识库ID,文件ID

输出：Dict{是否成功：bool}

##### 改

输入：用户ID,知识库ID,文件ID

输出：Dict{是否成功：bool，文件id,文件元信息：metadata}

##### 获取

输入：用户ID,知识库ID,文件过滤条件

输出：list【文件元信息】

##### 检索

输入：用户ID,知识库ID,可选（文件ID），可选（文件过滤条件），用户输入（文本、图片）

输出：list【chunk元信息（如果是图片和表格则包含相邻chunk）】

##### 问答

输入：用户ID,知识库ID,可选（文件ID），可选（文件过滤条件），用户输入（文本、图片），历史消息

输出：文本、图片信息

#### 多模态问答思路

输入：用户输入文本或者图片或者文本+图片

如果是纯文本，进行混合检索，重排序--》VL大模型

如果非纯文本，先预处理，文本embedding，图片embedding，文本+图片加财报方面提示词--》分析结果--》分析结果+文本+图片进行embedding。然后混合检索，重排序--》VL大模型

输出：文本、图片
