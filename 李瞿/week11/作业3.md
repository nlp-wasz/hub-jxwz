### ✅ 作业3：Milvus 数据结构设计

#### 1. **Collection 设计**
```python
collection_name = "multimodal_rag_kb"
```

#### 2. **字段设计**
| 字段名 | 类型 | 描述 |
|-------|------|------|
| `id` | INT64 | 主键，自增 |
| `text_bge_vector` | FLOAT_VECTOR(512) | 文本的 bge 编码向量 |
| `text_clip_vector` | FLOAT_VECTOR(512) | 文本的 CLIP 编码向量 |
| `image_clip_vector` | FLOAT_VECTOR(512) | 图像的 CLIP 编码向量 |
| `chunk_id` | VARCHAR(256) | 文本切块ID |
| `doc_id` | VARCHAR(256) | 所属文档ID |
| `page` | INT | 页面号 |
| `content` | TEXT | 文本内容 |
| `image_path` | VARCHAR(500) | 图像文件路径或URL |
| `metadata` | JSON | 其他元信息（如标题、作者等） |

#### 3. **索引设计**
```python
# 创建向量索引
index_params = {
    "index_type": "IVF_FLAT", # 基于倒排文件的索引结构，适合中等规模数据集（百万级），能提供较好的检索速度和精度平衡。
    "metric_type": "COSINE", # 指定距离度量方式为 COSINE，即使用 余弦相似度 来计算向量之间的相似性。余弦相似度适用于语义匹配场景，能够有效衡量两个向量的方向一致性。
    "params": {"nlist": 100} # nlist: 将整个向量空间划分为 100 个聚类中心（cluster），每个 cluster 对应一个“桶”（bucket）。查询时先定位到最近的 bucket，再在该 bucket 内进行精确搜索，从而提升效率。
}

# 分别为三个向量字段创建索引
client.create_index(
    collection_name="multimodal_rag_kb",
    field_name="text_bge_vector",
    index_params=index_params
)

# 为 text_clip_vector 创建索引
client.create_index(
    collection_name="multimodal_rag_kb",
    field_name="text_clip_vector",
    index_params=index_params
)

# 为 image_clip_vector 创建索引
client.create_index(
    collection_name="multimodal_rag_kb",
    field_name="image_clip_vector",
    index_params=index_params
)

```


#### 4. **数据存储逻辑**
- **文档解析**：使用 `DeepSeek-OCR` 或 `mineru` 解析 PDF，输出 Markdown 格式。
- **文本切分**：按段落或句子切分为 chunk。
- **向量化**：
  - 使用 `bge` 对文本 chunk 编码 → `text_bge_vector`
  - 使用 `CLIP` 对文本和图像分别编码 → `text_clip_vector`, `image_clip_vector`
- **存储**：将每个 chunk 的向量和元信息插入 Milvus。