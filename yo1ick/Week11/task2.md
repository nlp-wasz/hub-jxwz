# task2

## 多模态RAG提问方式处理差异分析

### 预处理阶段差异

| 处理维度 | 纯文本提问 | 文本+图片提问 |
| ------------ | --------------- | ------------------- |
| 输入解析 | 仅需进行分词、去停用词等文本清洗 | 需同步处理文本（同左）和图像（格式校验、分辨率归一化、压缩） |
| 模态检测 | 单一文本模态，无需模态识别 | 需通过MIME类型或文件头检测图像合法性，区分主模态（文本）和辅助模态（图像） |
| 异常处理 | 仅处理文本空值/过长问题 | 需额外处理图像损坏、格式不支持（如SVG矢量图）、尺寸超限等问题 |

### 特征提取阶段差异

| 处理维度 | 纯文本提问 | 文本+图片提问 |
| ------------ | --------------- | ------------------- |
| 模型选择 | 仅使用文本编码器（如BERT、Sentence-BERT） | 需协同文本编码器和图像编码器（如CLIP ViT-L/14、ResNet-50） |
| 特征维度 | 输出单一文本向量（通常768/1024维） | 输出文本向量+图像向量，需通过投影矩阵对齐至同一特征空间 |
| 计算资源 | 单模态编码，GPU占用率＜30% | 双模态并行编码，GPU峰值占用率提升40%-60% |

### 检索策略差异

| 处理维度 | 纯文本提问 | 文本+图片提问 |
| ------------ | --------------- | ------------------- |
| 检索入口 | 直接使用文本向量检索文本库 | 采用"双向量融合检索"：<br>1. 文本向量检索文本库<br>2. 图像向量检索图像库<br>3. 通过交叉注意力机制融合结果 |
| 权重分配 | 单向量权重为1.0 | 动态权重分配（默认文本0.6+图像0.4），支持用户自定义调节 |
| 过滤逻辑 | 仅基于文本元数据过滤（如文档类型、时间戳） | 新增图像特征过滤（如颜色直方图、物体检测标签） |

### 结果融合阶段差异

| 处理维度 | 纯文本提问 | 文本+图片提问 |
| ------------ | --------------- | ------------------- |
| 候选集来源 | 仅文本片段（top_k=5-10） | 混合文本片段（60%）、图像描述（30%）、图文关联块（10%） |
| 排序机制 | 基于文本余弦相似度降序排列 | 采用多模态重排序模型（如ALBEF），综合文本相似度、图像相似度、跨模态匹配度 |
| 引用生成 | 仅标注文本来源（文档ID+页码） | 需同时标注图像来源（URL/存储路径）及图文关联置信度（0-1.0） |

### 典型案例对比

**用户提问1**（纯文本）：  
"请说明产品X的尺寸参数"
- 处理流程：文本编码→检索产品说明书文本块→提取尺寸数据→生成文本回答
- 耗时：320ms
- 准确率：92%（基于文本匹配）

**用户提问2**（文本+图片）：  
"这个零件和图片中的产品X是否兼容？"（附零件照片）
- 处理流程：文本编码+图像编码→分别检索文本库和图像库→跨模态匹配→重排序融合→生成图文混合回答
- 耗时：890ms
- 准确率：87%（需结合视觉特征判断）

### 关键技术挑战

- **模态鸿沟**：文本与图像特征空间差异需通过对比学习（Contrastive Learning）弥合
- **计算开销**：双模态处理延迟较纯文本平均增加1.8倍，建议采用模型量化（INT8）优化
- **歧义处理**：当文本与图像信息冲突时（如"红色产品"配蓝色图片），需引入置信度阈值（默认0.7）决定优先模态

> 注：实际部署中可通过配置参数 `enable_mixed_retrieval` 控制是否启用多模态处理流程，默认值为 `true`
